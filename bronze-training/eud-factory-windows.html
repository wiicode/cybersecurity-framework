<!--
title: Reset and reprovision - Windows devices
description: Discover the ways in which organisations can restore Windows devices from a misconfigured or potentially compromised state to a known-good state.
published: true
date: 2021-02-22T00:30:32.279Z
tags: bronze, bronze-training, ncsc
editor: ckeditor
dateCreated: 2021-02-22T00:30:32.279Z
-->

<h1>Reset and reprovision - Windows devices</h1>
<p>Discover the ways in which organisations can restore Windows devices from a misconfigured or potentially compromised state to a known-good state.</p>
<p>This guidance is for organisations deploying or redeploying Windows devices onto their networks. It describes the ways in which devices can be restored from a misconfigured or potentially compromised state to a known-good state, using Windows' native functionality.</p>
<h2>Windows devices can be reset using the following methods.</h2>
<ol>
  <li><a href="https://www.ncsc.gov.uk/collection/end-user-device-security/factory-reset-and-reprovisioning/reset-and-reprovision-windows-devices#keep">'Reset this PC' - keep my files</a></li>
  <li><a href="https://www.ncsc.gov.uk/collection/end-user-device-security/factory-reset-and-reprovisioning/reset-and-reprovision-windows-devices#remove">'Reset this PC' - remove everything</a></li>
  <li><a href="https://www.ncsc.gov.uk/collection/end-user-device-security/factory-reset-and-reprovisioning/reset-and-reprovision-windows-devices#manual">Manual re-install</a></li>
  <li><a href="https://www.ncsc.gov.uk/collection/end-user-device-security/factory-reset-and-reprovisioning/reset-and-reprovision-windows-devices#tpm">Clearing the TPM (trusted platform module)</a><br>&nbsp;</li>
</ol>
<p>Each of these methods is explained in full alongside the risks of using them. We then recommend methods to use in each of the following four common scenarios:</p>
<p><strong>Scenario 1: Sanitising a device believed to be compromised with malware</strong><br>Use this reset method if a user has reported that their device behaving strangely, or has executed potentially malicious code on the device. This method will remove any malware from the device so that it can be reused.</p>
<p><strong>Scenario 2: Preparing a device which has not previously been managed</strong><br>Use this reset method if a device is to be provisioned onto the corporate network, but the history of the device is unclear. This method will restore the device to an 'out-of-box' state so that it can be provisioned as per existing guidance on deploying new devices.</p>
<p><strong>Scenario 3: Reissuing a device to a different user in the same security environment</strong><br>Use this reset method where a device is to be transferred between different employees, and is to be reset to factory settings so that the reprovisioning steps for that platform can be followed as if the device were new.</p>
<p><strong>Scenario 4: Sanitising a device for release to lower security domain or sale</strong><br>Use this reset method if the device is to be transferred out of a secure environment and you wish to perform a best-endeavours sanitisation of the device.</p>
<p><strong>Note:</strong>&nbsp;Malware exists with the ability to infect the firmware of components, such as the BIOS of a motherboard. While the persistence of such malware is beyond the scope of this guidance, it is known to exist and its removal cannot be guaranteed with any of the methods discussed below.</p>
<h2>'Reset this PC' - keep my files</h2>
<p>This&nbsp;<a href="http://windows.microsoft.com/en-gb/windows-8/restore-refresh-reset-pc">system refresh</a>&nbsp;functionality is primarily aimed at fixing a Windows installation that no longer functions properly, or has slowed down significantly since initial installation, without affecting the user’s data. User files and personalisation settings (such as wallpapers and themes are left unchanged).</p>
<p>To perform a system refresh, use the following option.</p>
<p><code>PC Settings --&gt; Update &amp; security --&gt; Recovery --&gt; Reset this PC&nbsp;--&gt; Keep my files</code></p>
<h3><br><strong>What happens</strong></h3>
<p>During the refresh, the PC first boots into the Windows Recovery Environment. From here, user files and applications to be retained are marked for exclusion from the refresh process. A new copy of Windows is then installed, after which the retained data is restored.</p>
<p>Some system settings are maintained. However, some settings that are deemed by Microsoft to be commonly misconfigured (and therefore could potentially cause issues) are intentionally reset back to the system default. The following table shows some examples of which settings are kept, and which are deleted.</p>
<figure class="table" style="width:635px;">
  <table style="background-color:rgb(255, 255, 255);border-bottom:0px;border-left:0px;border-right:0px;border-top:0px;">
    <thead>
      <tr>
        <th style="border-bottom:none;border-left:0px;border-right:0px;border-top:1px solid rgb(170, 170, 170);padding:0px 0px 16px;"><strong>Settings kept</strong></th>
        <th style="border-bottom:none;border-left:0px;border-right:0px;border-top:1px solid rgb(170, 170, 170);padding:16px 0px 16px 30px;"><strong>Settings deleted</strong></th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td style="border-bottom:none;border-left:0px;border-right:0px;border-top:1px solid rgb(170, 170, 170);padding:0px 0px 16px;">Wireless network connections</td>
        <td style="border-bottom:none;border-left:0px;border-right:0px;border-top:1px solid rgb(170, 170, 170);padding:16px 0px 16px 30px;">Mobile broadband connections</td>
      </tr>
      <tr>
        <td style="border-bottom:none;border-left:0px;border-right:0px;border-top:1px solid rgb(170, 170, 170);padding:0px 0px 16px;">BitLocker and BitLocker To Go settings</td>
        <td style="border-bottom:none;border-left:0px;border-right:0px;border-top:1px solid rgb(170, 170, 170);padding:16px 0px 16px 30px;">Drive letter assignments</td>
      </tr>
      <tr>
        <td style="border-bottom:none;border-left:0px;border-right:0px;border-top:1px solid rgb(170, 170, 170);padding:0px 0px 16px;">Personalisation settings such as lock screen background, and wallpaper</td>
        <td style="border-bottom:none;border-left:0px;border-right:0px;border-top:1px solid rgb(170, 170, 170);padding:16px 0px 16px 30px;">File type associations</td>
      </tr>
      <tr>
        <td style="border-bottom:none;border-left:0px;border-right:0px;border-top:1px solid rgb(170, 170, 170);padding:0px 0px 16px;">Display settings</td>
        <td style="border-bottom:none;border-left:0px;border-right:0px;border-top:1px solid rgb(170, 170, 170);padding:16px 0px 16px 30px;">Windows firewall settings</td>
      </tr>
      <tr>
        <td style="border-bottom:none;border-left:0px;border-right:0px;border-top:1px solid rgb(170, 170, 170);padding:0px;" colspan="1">Microsoft-approved applications from the Windows store</td>
        <td style="border-bottom:none;border-left:0px;border-right:0px;border-top:1px solid rgb(170, 170, 170);padding:16px 0px 0px 30px;" colspan="1">All third party applications, including applications installed from removable media and non-Microsoft locations on the internet</td>
      </tr>
    </tbody>
  </table>
</figure>
<p>Note that after the refresh, a list of removed applications is created on the desktop. Further details can be found at the&nbsp;<a href="https://support.microsoft.com/en-us/help/12415/windows-10-recovery-options">Recover Options in Windows 10 support website</a>.&nbsp;<br>&nbsp;</p>
<h3><strong>Malware removal</strong></h3>
<p>By default, this method will remove all third party applications, including any malicious applications that may have been previously installed by the user. These will be backed up into the&nbsp;<strong>Windows.old</strong>&nbsp;folder which can then be removed manually.</p>
<p>Note that:</p>
<ul>
  <li>if malware was distributed through the Microsoft app store, it could persist through the re-installation of this 'approved' application</li>
  <li>all user files are retained and malicious files on the disk will persist through this process<br>&nbsp;</li>
</ul>
<h3><strong>Risks</strong></h3>
<ul>
  <li>This method does&nbsp;<strong>not</strong>&nbsp;alter or remove any user data, which could allow malicious files to persist. Malicious files and malware could persist in various areas untouched by the refresh process and re-infect the device after resetting.</li>
  <li>This method only selectively removes configurations and settings. To ensure all settings are subsequently set to their expected values, the machine should have a full set of policies applied to it though Active Directory or other mechanism.</li>
  <li>This process relies on the integrity of the recovery environment. Malware which had compromised the recovery partition could persist into the new environment.</li>
</ul>
<h2>'Reset this PC' - remove everything</h2>
<p>This&nbsp;<a href="http://windows.microsoft.com/en-gb/windows-8/restore-refresh-reset-pc">reset method</a>&nbsp;provides a simple ‘one click’ method of erasing user data and reinstalling the operating system to its default state. All configurations and settings are cleared, so any post-installation system hardening or security configuration will need to be re-applied.</p>
<p>To perform a system reset, use the following option.</p>
<p><code>PC Settings --&gt; Update &amp; security --&gt; Recovery --&gt; Reset this PC&nbsp;--&gt; Remove everything</code></p>
<p>The user is provided with two options for the reformatting of the drive.</p>
<ol>
  <li><strong>Just remove my files</strong><br>Using this option, all references to files are removed and the files are marked as deleted (and therefore may be overwritten in future). However the data for the actual file is not removed until it is overwritten. This makes it possible for forensic software to easily recover the previously deleted files.</li>
  <li><strong>Remove files and clean the drive</strong><br>This option removes data in a more secure way, and writes data over every sector of the drive before formatting it for use. This makes it much more difficult to recover files from the drive.<br>&nbsp;</li>
</ol>
<h3><strong>What happens</strong></h3>
<p>With both options, all user data and files are removed. Additionally, all installed applications are removed, including official Microsoft applications and any software installed from the Microsoft app store. Only default or stock applications are reinstalled.</p>
<p>When using&nbsp;<strong>Reset this PC&nbsp;</strong>on a drive with BitLocker full disk encryption or ‘Device Encryption’ enabled, the process will simply delete the decryption key, making recovery of the encrypted data impossible. BitLocker can also provide protection against boot sector malware, by using the TPM to verify the integrity of boot files.<br>&nbsp;</p>
<h3><strong>Malware removal</strong></h3>
<p>The&nbsp;<strong>Remove files and clean the drive</strong>&nbsp;option will write data to all sectors of the drive. This includes all partitions, destroying all data on the disk, preventing any malware persisting the reset process.</p>
<p>The&nbsp;<strong>Just remove my files</strong>&nbsp;option may not wipe all sectors of the disk and could allow malware to persist after the process. For example, if malware were to infect the boot sector of the drive, it may not be sanitised using&nbsp;<strong>Just remove my files</strong>&nbsp;option and therefore may persist. The Secure Boot feature on supported devices should mitigate this.<br>&nbsp;</p>
<h3><strong>Risks</strong></h3>
<ul>
  <li>Since all PC settings are removed and changed back to default, any security settings would have to be re-applied. To ensure all settings are subsequently set to their expected values, the machine should have a full set policies applied to it though Active Directory or other mechanism.</li>
  <li>The<strong>&nbsp;Just remove my files&nbsp;</strong>option will&nbsp;<strong>not</strong>&nbsp;securely remove all data, allowing basic forensic tools to recover many of the files.</li>
  <li>The&nbsp;<strong>Remove my files and clean the drive</strong>&nbsp;option may not encompass the entire drive, which could allow malware to reside in areas such as the boot sector. This process relies on the integrity of the recovery environment. Malware which had compromised the recovery partition could persist into the new environment.</li>
</ul>
<h2>Manual re-install</h2>
<p>Reinstalling Windows manually involves the following:</p>
<ul>
  <li>manually wiping hard drive using a tool such as ‘<a href="https://en.wikipedia.org/wiki/Dd_(Unix)">dd</a>’</li>
  <li>generating a new partition table</li>
  <li>formatting those partitions</li>
  <li><a href="http://windows.microsoft.com/en-gb/windows-8/clean-install">re-installing Windows</a>&nbsp;from installation media</li>
</ul>
<p>All configurations and settings are cleared, so any post-installation system hardening or security configuration will need to be re-applied.<br>&nbsp;</p>
<h3><strong>What happens</strong></h3>
<p>Manual re-instal is in many ways similar to the&nbsp;<a href="http://cesgdet.atlassian.net/#remove">Reset this PC</a>&nbsp;option described above (which essentially automates the manual process, and presents it in a way that allows non-technical users to perform the same tasks).</p>
<p>However, a manual re-install provides some benefits over the automated process. By manually wiping the drive, steps such as writing the drive with random data can be performed or omitted as necessary. This can save a large amount of time if the secure removal of data is not an issue. While this is offered in the&nbsp;<strong>Just remove my files</strong>&nbsp;option, manually performing these tasks also provides certainty that all sectors of the drive have been overwritten.<br>&nbsp;</p>
<h3><strong>Malware removal</strong></h3>
<p>This method removes all malware, provided that all sectors of the drive are wiped before formatting and installation.<br>&nbsp;</p>
<h3><strong>Risks</strong></h3>
<ul>
  <li>All PC settings are removed and changed back to default. Any security settings have to be re-applied.</li>
  <li>There's potential for certain configuration settings to be forgotten or missed.</li>
  <li>All partitions must be wiped to ensure that no malware persists.</li>
</ul>
<h2>Clearing the TPM (trusted platform module)</h2>
<p>This feature will only be of use if the device is encrypted using a key stored in the TPM, such as when usingBitLocker. When the TPM is cleared, it wipes any keys that are stored on the TPM so that any data that has been encrypted using those keys will not be accessible without the BitLocker Recovery Key.</p>
<p>Exactly how to clear the TPM will vary per device manufacturer, but will generally approximate the following process:</p>
<p><code>BIOS/UEFI Setup menu --&gt; Security --&gt; TPM Security --&gt; Tick the "Clear" box</code></p>
<p>A new OS will need to be installed, meaning that all settings will then be the defaults.<br>&nbsp;</p>
<h3><strong>What happens</strong></h3>
<p>TPM clearing will wipe any keys stored within the TPM, so that any data that has been encrypted using those keys will not be accessible without the BitLocker Recovery Key.<br>&nbsp;</p>
<h3><strong>Malware removal</strong></h3>
<p>Any malware that was present on the encrypted disk will be effectively deleted.&nbsp;<br>&nbsp;</p>
<h3><strong>Risks</strong></h3>
<ul>
  <li>TPM clearing does not strictly erase data on the device; it makes reading that data impossible without the recovery key.</li>
  <li>The user will need to manually delete any backups of the recovery key (saved to external media, backed up in the cloud, etc.), otherwise recovery of the data will be possible.</li>
</ul>
<h2>Reprovisioning scenarios for Windows devices</h2>
<p>For the four common reprovisionining scenarios outlined above, the NCSC recommend the following methods.<br>&nbsp;</p>
<h3><strong>Scenario 1: Sanitising a device believed to be compromised with malware</strong></h3>
<p>When removing malware, we recommend that each sector of the hard drive is completely overwritten to ensure no malicious files persist. This is because some advanced malware has the ability to infect the boot sector.</p>
<ul>
  <li>Both<strong>&nbsp;Reset this PC (Remove everything)</strong>&nbsp;and&nbsp;<strong>Manual re-install&nbsp;</strong>offer the above functionality.</li>
  <li>If using,&nbsp;<strong>Reset this PC (Remove everything)</strong>&nbsp;, ensure you choose&nbsp;<strong>Remove files and clean the drive</strong>, as this option wipes all sectors of the drive.</li>
  <li><strong>Manual re-install</strong>&nbsp;will provide additional certainty when removing malware, as steps can be performed and verified manually.<br>&nbsp;</li>
</ul>
<h4><strong>Risks</strong></h4>
<ul>
  <li><strong>Manual re-install</strong>&nbsp;provides the most certainty with regards to malware removal, but also takes more time and effort. However, it also presents the opportunity for mistakes to be made, or steps to be missed.</li>
  <li><strong>Reset this PC (Remove everything)</strong>&nbsp;must use the&nbsp;<strong>Remove files and clean the drive&nbsp;</strong>option, as the&nbsp;<strong>Just remove my files</strong>&nbsp;option may not clear the boot sector of the drive.</li>
</ul>
<h3><strong>Scenario 2: Preparing a device which has not previously been managed</strong></h3>
<p>When preparing a device that has not been managed, you should assume it's carrying malware, and treat as described in scenario 1 above.<br>&nbsp;</p>
<h4><strong>Risks</strong></h4>
<ul>
  <li><strong>Manual re-install</strong>&nbsp;provides the most certainty with regards to malware removal, but also takes more time and effort. However, it also presents the opportunity for mistakes to be made, or steps to be missed.</li>
  <li><strong>Reset this PC (Remove everything)</strong>&nbsp;must use the&nbsp;<strong>Remove files and clean the drive&nbsp;</strong>option, as the&nbsp;<strong>Just remove my files</strong>&nbsp;option may not clear the boot sector of the drive.</li>
</ul>
<h3><strong>Scenario 3: Reissuing a device to a different user in the same security environment</strong></h3>
<p><strong>Reset this PC (Remove everything)</strong>&nbsp;is sufficient to transfer a device in which personal data is not available to the new user, but the new user would be able to recover the data using forensic software. If the new user should in no way be able to recover personal data from the device, then you should use the&nbsp;<strong>Remove files and clean the drive</strong>&nbsp;option, or&nbsp;<strong>Manual re-install</strong>.</p>
<h4><strong>Risks</strong></h4>
<ul>
  <li>The&nbsp;<strong>Just remove my files</strong>&nbsp;option of&nbsp;<strong>Reset this PC (Remove everything)</strong>&nbsp;will&nbsp;<strong>not</strong>&nbsp;attempt to securely wipe data, allowing it to be recovered using forensic tools and techniques.</li>
  <li><strong>Manual re-install</strong>&nbsp;provides the most certainty with regards to malware removal, but also takes more time and effort. However, it also presents the opportunity for mistakes to be made, or steps to be missed.</li>
</ul>
<h3><strong>Scenario 4: Sanitising a device for release to lower security domain or sale</strong></h3>
<p>Microsoft recommend their&nbsp;<strong>Reset this (Remove everything)</strong>&nbsp;option when sanitising a device for sale. Use this provided the&nbsp;<strong>Remove files and clean the drive&nbsp;</strong>option method is selected, which makes forensic file recovery difficult.</p>
<p>If the drive is using BitLocker encryption, we recommend using&nbsp;<strong>Reset this PC (Remove everything)</strong>, as encryption metadata will be deleted making data recovery impossible. Or Clearing the TPM, as this removes the keys in the TPM used to decrypt the data.</p>
<p>Where sensitive data resides on the hard drive of the machine (this includes the data that resides on a device after clearing the TPM) we recommend&nbsp;<strong>Manual re-install</strong>. This allows the number of random data passes to be customised, providing additional protection against advanced data recovery techniques.</p>
<p><strong>Reset this PC (Remove everything)&nbsp;</strong>requires significantly less time and effort to perform, as Microsoft have automated the majority of this process. However&nbsp;<strong>Manual re-install</strong>&nbsp;provides additional security surrounding the secure removal of sensitive data.</p>
<h4><strong>Risks</strong></h4>
<ul>
  <li>If using&nbsp;<strong>Reset this PC (Remove everything)</strong>, ensure that the&nbsp;<strong>Just remove my files</strong>&nbsp;option is&nbsp;<strong>not</strong>&nbsp;used. This option does&nbsp;<strong>not</strong>&nbsp;securely remove data from the drive, making it easy to recover using forensic tools.</li>
  <li>Even when using the&nbsp;<strong>Remove files and clean the drive</strong>&nbsp;option, note that only one pass of data will be written to the drive. While this makes it much more difficult to recover any meaningful data from the drive, a process of 3 passes of random data to each sector of the drive is recommended for the secure removal of data.</li>
  <li>TPM clearing does not strictly erase data on the device; if the recovery key or other credential still exists for the encrypted disk then data may be recoverable.</li>
</ul>
