<!--
title: Virtual Private Networks (VPNs)
description: Choosing, deploying and configuring VPN technologies
published: true
date: 2021-03-06T02:54:13.763Z
tags: guidance, bronze, mdm
editor: ckeditor
dateCreated: 2021-03-06T02:54:13.763Z
-->

<p>Virtual Private Networks (VPNs) allow organisations to provide secure connectivity between devices in physically separate locations. This guidance helps administrators within choose, deploy and configure VPNs for their organisation.</p>
<p>Individuals typically use VPNs for different reasons, which are not covered in this guidance.</p>
<hr>
<h2>Why use a VPN?</h2>
<p>VPNs are encrypted network connections. These allow remote users to securely access an organisation's services. VPNs are one way to guarantee the security of 'data in transit' across an untrusted network, but they also provide several other benefits.</p>
<p>For example, an organisation with offices in multiple locations can use VPNs to provide its remote users with access to corporate email and file services.</p>
<h3><strong>Additional advantages of VPNs</strong></h3>
<ol>
  <li>Enabling legacy systems to work remotely, even when not design for such scenarios. For example, SMB file servers</li>
  <li>Providing a second layer of defence against misconfigured, unpatched, or poorly designed internal services. For example, intranet websites that aren’t well maintained, or use legacy cryptography</li>
  <li>Protecting internal network servers from external, unauthenticated attackers, by limiting network access to authenticated devices. For example, file stores or databases</li>
  <li>Protecting user devices from network attack by preventing direct connections to and from the local network. For example, ARP spoofing attacks, or attacking open network interfaces on the mobile device</li>
  <li>Forcing traffic between a device and external services through internal, protective monitoring tools, guarding against a variety of threats. For example, inspecting web content for malicious code</li>
  <li>Enabling business monitoring and/or filtering of users’ network traffic for legal reasons, discipline, and duty of care. For example, blocking access to illegal websites</li>
</ol>
<p>Protecting data in transit is one of the most important security aspects to consider when using mobile devices. Attackers with access to unprotected data (or inadequately-protected data) may be able to intercept and modify data, potentially causing harm. It is therefore important to decide which of the above benefits are relevant to your organisation <strong>before</strong> deciding which VPN technology to use, and how to use it.</p>
<hr>
<h2>Preparation for VPN use</h2>
<h3><strong>Do you need a VPN?</strong></h3>
<p>Whether you require a VPN will depend on the <a href="https://www.ncsc.gov.uk/collection/mobile-device-guidance/infrastructure/network-architectures-for-remote-access">network architecture</a> you use. For example, there would be little benefit in using a VPN if you've fully adopted a <a href="https://www.ncsc.gov.uk/collection/mobile-device-guidance/infrastructure/network-architectures-for-remote-access">zero-trust approach to networking</a>.</p>
<p>Also, if none of the advantages of VPNs mentioned above apply to you, there is no need to use one. Even if some of those reasons apply to you, there may be alternative ways to address the base problem. Legacy services may not be needed on devices outside the firewall, or blocking access to illegal websites could be done on-device, if required.</p>
<p>VPNs are complex to set up, require maintenance, and failure of a VPN could easily cause organisation-wide outages.</p>
<p>If you're using a <a href="https://www.ncsc.gov.uk/collection/mobile-device-guidance/infrastructure/network-architectures-for-remote-access">walled garden architecture</a>, or other architecture that requires end users' traffic to traverse untrusted networks and external firewalls then you should consider using a VPN. However, there are many aspects of a VPN to consider. These are addressed next.</p>
<h3><strong>Protocols</strong></h3>
<p>The protocols most widely used for VPNs are Transport Layer Security (TLS) and Internet Protocol Security (IPsec). There are a variety of others, some of which (<a href="https://en.wikipedia.org/wiki/Point-to-Point_Tunneling_Protocol">PPTP </a>for example) have fallen out of use because of security concerns. Other protocols, such as Wireguard are growing in popularity and seem promising, but are yet to be proven in enterprise contexts.</p>
<p>Our recommendation is that IPsec be used for VPN access. IPsec is an open standard, meaning that anyone can build a client or server which will work with other IPsec implementations.</p>
<p>As an IPsec VPN client is built into many operating systems, no additional products are required to deploy a VPN. However, some third-party networks restrict or block IPsec traffic, so your mobile devices may, in certain situations, be unable to create the VPN connection.</p>
<p>TLS VPNs can also be used, though you will likely need to use a third-party client and server. In addition, products from different vendors will rarely inter-operate, so you will need to use both from the same vendor. Whilst TLS is standardised in a variety of <a href="https://en.wikipedia.org/wiki/Request_for_Comments">RFCs</a>, exactly how those protocols are used to create a VPN is not. However, TLS VPN connections can be more reliable when traversing Network Address Translation (NAT) devices, or enterprise firewalls.</p>
<p>From a security perspective, with all other things equal, there is very little difference in risk between using an IPsec and a TLS VPN.</p>
<h3><strong>Cryptography</strong></h3>
<p>We recommend client certificates for machine authentication, when using a VPN. Certificates have several advantages over Pre-Shared Keys (PSKs), including the ability to revoke just one certificate on your network and to store private keys securely (e.g. in a TPM or TEE), which we strongly recommend, when possible.</p>
<p>For specific guidance on configuring cryptographic parameters, see the NCSC's separate guidance on <a href="https://www.ncsc.gov.uk/guidance/using-ipsec-protect-data">Using IPsec to protect data</a> and <a href="https://www.ncsc.gov.uk/guidance/tls-external-facing-services">Using TLS to protect data</a>. As these recommended configurations are not always fully supported by built-in VPN clients on mobile operating systems. We also give per-platform recommendations in the per-platform mobile device guidance.</p>
<p>By using weaker profiles or algorithms than those recommended below, you will increase the risk of data compromise while in transit over untrusted networks.</p>
<h3><strong>Integrated vs third-party VPN clients</strong></h3>
<p>Most operating systems have a built-in VPN client available which can either be configured on the device or managed remotely. Integrated clients are normally free to use, work reliably, and are updated automatically, but can also be relatively limited in functionality. For example, there’s often no ability to configure routing rules, exceptions, or split tunnelling.</p>
<p>We recommend using the native client where possible, and our platform specific guidance provides configuration details. However, a range of commercially available third-party VPN clients exists.</p>
<p>Using a third-party VPN client increases the risk that operating system integration will be poor, and that consequently, some data may be sent outside the VPN. It also increases the number of software packages that need to be kept up to date, adding to the likelihood that some out-of-date software will be in use.</p>
<h3><strong>Forced vs optional</strong></h3>
<p>Only traffic which is routed over the VPN will be protected by it, so you might want to force all traffic to be routed via the VPN, and for no user traffic to transit outside that connection. This will require either the VPN client itself to enforce this, or a client firewall configured to prevent connections being established outside of the VPN. If a forced VPN is unable to connect, then no network traffic from the device will be possible, unless the VPN is disabled.</p>
<p>Our guidance generally recommends forcing traffic down the VPN, and where possible, the per-platform guidance provides ways of achieving this. Where it's not possible to force traffic, this represents a risk to your data. However, forced connections can sometimes cause incompatibilities with captive portals on public Wi-Fi networks, unless the platform offers a solution for authenticating to them.</p>
<p>Using an optional VPN allows users to disable the VPN and evade <a href="https://www.ncsc.gov.uk/collection/mobile-device-guidance/logging-and-protective-monitoring">protective monitoring and auditing</a> services. This increases the risk of mobile devices being attacked over the network, and of users circumventing corporate policy restrictions.</p>
<h3><strong>Initiating a VPN connection</strong></h3>
<p>To provide benefits, a VPN must establish a connection, remain connected while the device is in use, and reconnect if the connection is temporarily lost. Typically, there are three ways of implementing this behaviour: automatic, triggered, and manual.</p>
<ul>
  <li>Automatic VPNs are brought up by the device whenever a network connection is requested by software on the device.</li>
  <li>Triggered VPNs are brought up whenever certain network connections from a defined list are made (internal intranet sites, for example).</li>
  <li>Manual VPNs require the user of the device to initiate the VPN by explicitly deciding to take an action (such as launching an application and clicking connect). The user will likely need to take this step again if the connection drops during or after use.</li>
</ul>
<h3><strong>Distinguishing automatic from forced VPNs</strong></h3>
<p>We distinguish automatic from forced because on some platforms it is possible for the user to disable the automatic VPN, whilst the platform still enforces VPN routing. This effectively prevents network connections from the device until the user re-enables automatic connections.</p>
<p>Depending on whether the VPN is forced or optional, choosing between automatic, triggered and manual could be a usability decision rather than security.</p>
<p>If the VPN is forced, but the initiation is manual, this will be a poor user experience as the device will not have any connectivity until the user manually starts the VPN. Conversely, if the VPN is optional, and the initiation is manual, then there is a risk of compromise from local attackers on an untrusted network, during the period when the device is not connected.</p>
<p>We advise you to use an automatic VPN, and where possible our per-platform guidance outlines a way of achieving this.</p>
<h3><strong>Full-device vs per-app VPN</strong></h3>
<p>Some operating systems and many third-party applications allow you to configure only certain applications to use a VPN on the device. This is mostly useful in a <a href="https://www.ncsc.gov.uk/collection/mobile-device-guidance/bring-your-own-device">Bring Your Own Device (BYOD) scenario</a>, where enterprises do not want network traffic from personal apps to traverse the corporate network. This approach can be used to prevent malicious personal apps attacking the corporate network, or to limit bandwidth consumption from data-intensive personal apps. A per-app VPN also enables latency-sensitive apps (such as VoIP applications) to avoid any increase in network latency from the VPN.</p>
<p>However, if deploying in this way, you need to define all the applications you want protected by the VPN in advance. As this is generally used in a BYOD scenario, users can always download another application to work around the per-app VPN restrictions. In some cases, it may not be possible to force system applications to use a per-app VPN.</p>
<p>Our per-platform guidance recommends - and provides a configuration for - setting up a full-device VPN. Using a per-app VPN increases the risk that sensitive data may be sent outside the VPN by an application that is not included in a per-app VPN, or by a misconfiguration in the platform.</p>
<h3><strong>Split tunnelling</strong></h3>
<p>Like a per-app VPN, split tunnelling is a way of having some traffic use the VPN, whilst other traffic is permitted direct connectivity. This is generally achieved by only defining certain network routes (e.g. internal IP address ranges) as available via the VPN. The default gateway for all other traffic is then left as a direct connection.</p>
<p>This is generally used when the VPN is providing access to internal services on a corporate network, without attempting to prevent other connections. For example, high-bandwidth applications could be permitted direct access to the internet without being routed via corporate infrastructure, to save on bandwidth costs. And, as with per-app VPNs, latency-sensitive applications, such as a VoIP client, could minimise network latency by connecting directly.</p>
<p>Split tunnelling is generally not supported on native VPN clients, which typically have relatively simple configuration options. Windows operating systems can be configured to split tunnel by the VPN's CSPv2 XML. However, on other platforms, clients built into smartphones and tablets rarely support this configuration. Third-party clients are sometimes able to support this option.</p>
<p>Enabling split tunnelling increases the risk that sensitive data will be exposed to an unprotected network, and could enable external attackers to access internal resources by ‘pivoting’ through the mobile device. In a scenario where you are relying on the VPN to route traffic for protective monitoring or duty of care reasons, enabling split tunnelling will undermine the benefit gained from those protections.</p>
<h3><strong>Managed tunnels</strong></h3>
<p>If there are specific services that you want to access outside of the VPN, you can do this through the use of managed tunnels. This involves traffic to that particular endpoint being sent outside of the configured VPN. Sensible reasons for doing this include reduction of the load on networks caused by video conferencing services or where the function of an application requires it to communicate directly on the network, such as Wi-Fi captive portal helpers.</p>
<p>We only recommend the use of managed tunnels in situations where the provider of the service that will be connected to outside the tunnel, provides:</p>
<ol>
  <li>Information demonstrating that connections to the service are protected as well as they would be by the VPN&nbsp;(e.g. the use of mutual TLS authentication).</li>
  <li>Definitive statements that the service uses dedicated IP endpoints, so that only traffic to that specific service will pass outside of the VPN.</li>
</ol>
<p><strong>And</strong>&nbsp;where there’s a business requirement for users to access the service outside of the VPN - i.e. high-bandwidth services such as those&nbsp;<a href="https://www.ncsc.gov.uk/guidance/video-conferencing-services-security-guidance-organisations">used for video conferencing</a>. We would also recommend this approach to enable Wi-Fi captive portal helpers to function</p>
<h3><strong>Captive portals</strong></h3>
<p>Captive portals are the login pages present on some public Wi-Fi networks. To use a captive portal, the device is required to establish a direct connection from a web browser to the portal before it has established a VPN connection. For this, one of two things must be configured</p>
<p><strong>Either:</strong></p>
<p>1. The user can disable any forced VPN configuration, so they can manually navigate to the portal in their main web browser.</p>
<p><strong>Or</strong></p>
<p>2. The platform itself can detect the presence of a captive portal and present the user with a captive portal assistant application to authenticate with before re-establishing the VPN. Some platforms, such as iOS and macOS have such an application built in. Assistants are available as a third-party application for some other platforms, such as Windows 10. We include a link to one we have developed in our <a href="https://www.ncsc.gov.uk/collection/mobile-device-guidance/platform-guides">Windows 10 guidance</a>.</p>
<p>The use of a captive portal assistant application is less risky and should be preferred if captive Wi-Fi networks are to be used. The risks of disabling forced VPNs are described earlier in this guidance.</p>
<hr>
<h2>Wider considerations</h2>
<p>There are certain issues which are not directly related to the configuration of the VPN, but which will be affected by your choice of technologies and configurations, as outlined in the previous section.</p>
<p>There are certain issues which are not directly related to the configuration of the VPN, but which will be affected by your choice of technologies and configurations, as outlined in the previous section.</p>
<h3><strong>Client and Server security updates</strong></h3>
<p>As with all software, both the client and server component will need to be regularly updated. On devices where the client is integrated into the operating system, these updates will naturally happen as a result of regular platform updates. Third-party software will need to be updated in some other way.</p>
<p>VPN services will be part of the internet-exposed attack surface of your organisation, so will need to be swiftly updated as soon as security patches are released</p>
<h3><strong>Tethering to devices with a VPN</strong></h3>
<p>Tethering, or mobile hotspots, involve connecting an external device to your smartphone in order to use the smartphone’s internet connection.</p>
<p>However, full-device VPNs can often have an impact on how tethering works on the underlying platform. Some platforms will route tethered devices’ connections outside of the smartphone’s VPN connection, while some smartphones will not route tethered traffic if there is a full-device VPN connected. If your users rely on tethering, an appropriate configuration should be selected to enable it.</p>
<hr>
<h2>How to use a VPN</h2>
<p>There are two components to decide on: the Client and the Server.</p>
<p>You may wish to use the same vendor for both components, or adopt an open standard and use different vendors. Regardless, you should consider each aspect of VPN configuration described above.</p>
<p>The NCSC recommends:</p>
<ul>
  <li>Use the <strong>IPsec</strong> protocol to give you the flexibility to choose from a wide variety of inter-operable products.</li>
  <li>Use <strong>certificate authentication</strong>. Store private keys in hardware-protected storage (TPM or TEE) if possible.</li>
  <li>Use the <strong>native client</strong> for your particular platform(s), if possible.</li>
  <li>Use a <strong>forced VPN</strong> to ensure apps cannot evade enterprise monitoring solutions (if you use them).</li>
  <li>Use a VPN which <strong>automatically connects</strong>, so the device user is not required to manually enable it.</li>
  <li>Use a<strong> full-device</strong> VPN and <strong>avoid split tunnelling</strong> to minimise the risk of data leaking outside the VPN.</li>
  <li>Use the platform's built-in captive portal helper, if there is one, or deploy a third-party one.</li>
  <li>Follow the NCSC's recommended cryptographic profiles for <a href="https://www.ncsc.gov.uk/guidance/using-ipsec-protect-data">IPsec </a>or <a href="https://www.ncsc.gov.uk/guidance/tls-external-facing-services">TLS</a>, as appropriate.</li>
</ul>
<p>The NCSC recommends that you test several VPNs to find which meet your requirements, are robust and resilient. As devices configured as suggested here will be largely unusable if the VPN service has an outage. It's especially important that the architecture is resilient and has backup options, if components within the service fail.</p>
