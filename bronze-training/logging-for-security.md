---
title: Introduction to logging for security purposes
description: Laying the groundwork for incident readiness.
published: true
date: 2021-02-21T03:31:00.968Z
tags: security operations, bronze, bronze-training
editor: markdown
dateCreated: 2021-02-21T03:22:50.683Z
---

# Introduction
Logging is the foundation on which security monitoring and situational awareness are built.

This guidance will help you devise an approach to logging that will help answer some of the typical questions asked during a cyber incident, such as:

- What has happened?
- What is the impact?
- What should we do next?
- Has any post-incident remediation been effective?
- Are our security controls working?

If you can answer these questions, even partially, it will help you to recover quickly from a cyber incident and develop your defences. This will reassure your customers, suppliers, investors and regulators that you have taken all measures necessary to protect your data and systems.

In later guidance, the logging approach we design here will form the basis of a more richly featured capability, geared towards detecting attacks as they happen.

# Audience
This guidance is for you if:

- Your organisation currently has little or no logging capability OR You would like to assess the suitability of your current logging capability
- You would like to be better prepared for a cyber incident
- You want to understand the NCSC’s expectations regarding basic good practice for logging

# Steps to Implementation
This guidance proposes a four step program for putting in place a simple but effective logging capability.

You will learn how to:

- A. Choose which logs to generate or retain: What questions do you need to answer?
- B. Decide how to retain logs
- C. Implement log storage and tooling for analysis
- D. Validate that your logging capability is working as intended

## A. Choose which logs to generate or retain: What questions do you need to answer?

Your first step is to generate a list of logs that could be used to determine whether your organisation’s IT has been compromised, and to what extent.

In the table below we've listed the common questions you're likely to be asked during the initial phases of a cyber incident. Working through these will help to focus your efforts and guide next steps.

### Accessing logs
If you outsource much of your IT, as many UK public sector bodies do, it can be difficult to access logging data without making unforeseen demands on your suppliers. The table below is configured to help with this situation, giving you some flexibility in how you obtain your logging data.

For example, there are several ways to collect web browsing activity - through a web proxy, host-based agent or (in a limited form) from DNS. If one source is providing contractually difficult to obtain, try another. There are often many ways to capture the data you need.

### Using the table
Work out which logs would give you visibility of the categories listed in the first column, and help to answer the questions in the second column. Identify where the relevant logs are generated, how, and for how long they are stored and secured.

This table covers the highest priority categories and questions, but is not an exhaustive list. You may identify other helpful data you can bring in to augment your overall picture.

You might be able to answer the questions without using the event sources listed - this is fine. Your answers, and how you find them, will depend on your unique architecture and technology choices.

### Host-based logs
Host-based logs can include those already generated by applications and operating systems, as well as more detailed events captured by host-based agents.

### Table 1: External network communications (and host based logging)
Visibility of communication between your network and other networks (i.e. the internet or 3rd party suppliers).

This information allows you to determine if an Indicator of Compromise has been seen on your systems.

| Incident questions | Event sources |
| --- | ----------- |
| Are any of our systems talking to a suspect external IP address? | IP connections are usually made from network devices such as firewalls, routers, and switches. These generate netflow or firewall logs containing the desired information (which you can also obtain by passively analysing network traffic at the boundary). Note: Captured logs should take into account if (and where) Network Address Translation (NAT) is used on the network, to capture the internal and external IP details. |

| Have any devices queried for a given specific domain? | Web proxy or host based agent logs should be able to generate domain (and URL) lookup information. Domain Name System (DNS) logs can find which domains are being looked up (resolved), and will show you the domain part of the link the user has clicked (but not the full url). |

| Has anyone in your organisation received an email with a similar subject to a given example? Has anyone clicked on the link? | Email events (including subjects and contents) can be generated from SMTP servers, MS Exchange, mail scanning appliances, cloud provider APIs or by passively parsing traffic. Web proxy logs can provide information on malware command and control traffic, or initial stages of an infection – such as clicking a link or downloading a malware dropper. Devices need to be configured to use web proxies, and the logs may miss on-device infections if web traffic reaches the Internet without going through the proxy |

| Has anyone in your organisation executed a given, suspect binary, or does a specified file exist on one of our systems? Has any anomalous activity happened on any host? E.g. Out of hours crashes, etc | This data can be derived from centralising already generated local system logs (e.g. Microsoft EVTX, Syslog), deploying free Windows tools (like Microsoft Sysmon), right through to purchasing commercial host agent tools. Host based agents and host logs (OS and application) are a rich source of information. They can generate process information, DNS lookup events, file system changes, file hashes, web requests, and so on. Their main limitation is that they must be consciously installed and configured onto operating systems, which leaves coverage gaps for unofficial ‘shadow’ IT, network devices, unsupported operating systems or where the malware has disabled the agent. |

### Table 2: Authentication and access
Capturing authentication and access attempts helps you to understand the impact of a compromise.

This is particularly useful in understanding the ‘Affect’ phase of the kill chain – uncovering lateral movement and data exfiltration (amongst other objectives)

| Incident questions | Event sources |
| --- | ----------- |
| Who has viewed or downloaded a specific document? | Document repository stores can provide a source of audit information for which documents have been accessed. Database and/or application logs for your sensitive assets (which could be bulk personal data repositories, design documents and so on) would be helpful if an attacker has successfully compromised your back end systems. |

| Have any incorrect authentication attempts occurred on an Internet exposed service (email, VPNs, web services, remote desktop)? | Email services and authentication servers (LDAP, Active Directory, ADFS or other) can provide metrics on authentication attempts and access information. |

| How have your corporate domain and end user devices been accessed and used? | Active Directory and Windows Logs. Windows can be configured to perform ‘Windows Event Forwarding’, allowing a secure way of forwarding logs from clients to a central store. This document from Microsoft contains some useful information. |

| Who has logged in remotely out of hours recently? Have authentication events happened at unexpected times or from unexpected locations? | VPN servers, remote desktop and VDI logs can capture IP address information and user logs, to show who has accessed the corporate network remotely. |

### Table 3: IT asset and configuration information
This helps an organisation gain context of assets when investigating (or confirming) a cyber attack. Without accurate asset information, organisations will struggle to delve into more detailed root cause analysis, or even have the right information to hand for recovery.

| Incident questions | Event sources |
| --- | ----------- |
| Which device used a specified internal IP address? | Usually a DHCP server will provide information to tie an IP address to a MAC address. The MAC address can then be used to query network hardware and find the physical location of a device. Some products combine these two functions. |

| Where is a specified device physically located? | Managed network switches should allow an administrator to identify (in combination with DHCP logs) a MAC address to a physical port. WiFi networking hardware can sometimes identify the approximate location of the device. |

| When did a network, server or end user device administrative configuration change occur? e.g. new local administrator account created on EUD, firewall rule change, etc | Capturing logs from network appliances (routers, firewalls, switches, etc) and operating systems should record events where administrative changes have been made. This document from Microsoftshows how to capture when a new local administrative user account is created on Windows. For more advanced and detailed analysis, a privileged access tool would help tie change request tickets to configuration changes. |

| What does a given server ‘do’? What is its business purpose, expected behaviour and system owner? Who should you call if there are issues? | An accurate Configuration Management Database (CMDB) is useful to record what a given server does on your estate. How this is captured will vary vastly between organisations, ranging from automatically recorded through orchestration and automation, all the way down to individual systems administrators storing this information in their heads. Cloud provider consoles, APIs or on-premise virtualisation consoles can provide a source of information about virtualised assets. Some providers allow users to add tags and descriptions to assets, which can be part of the engineering process and useful in incident investigations (as well as understanding spending). |



