<!--
title: Using TLS to protect data
description: How to configure the services that must be able to receive incoming connections from unknown clients or services.
published: true
date: 2021-02-22T00:32:05.089Z
tags: silver, ncsc, silver training
editor: ckeditor
dateCreated: 2021-02-22T00:32:05.089Z
-->

<h1>Using TLS to protect data</h1>
<p>How to configure the services that must be able to receive incoming connections from unknown clients or services.</p>
<p>This guidance outlines how to configure the services that must be able to receive incoming connections from unknown clients or services. Specifically it covers the scenarios of: operating a public website; embedded devices which need to communicate securely back to online services where certificate management and the overhead of IPsec would be too great; and supporting email transfer using Simple Mail Transfer Protocol (SMTP). This guidance does <strong>not</strong> address use of TLS for Virtual Private Networks (VPNs). The NCSC recommends the use of <a href="https://www.ncsc.gov.uk/guidance/using-ipsec-protect-data">IPsec to protect data in transit</a> in line with the <a href="https://www.gov.uk/government/uploads/system/uploads/attachment_data/file/261980/EUD_Security.pdf">Cabinet Office End User Device Strategy</a> as IPsec is a mature set of standards, widely available across many vendors of end user devices and networking equipment.</p>
<hr>
<h2>About TLS</h2>
<p>Transport Layer Security (TLS) is a protocol which provides privacy between communicating applications and their users, or between communicating services. When a server and client communicate, well-configured TLS ensures that no third party can eavesdrop or tamper with any message.</p>
<p>At the time of writing, the current version of TLS is version 1.2, which includes security improvements over version 1.0. The predecessor to the TLS protocol was the Secure Sockets Layer (SSL) protocol, all versions of which are now regarded as insecure.</p>
<hr>
<h2>Deploying TLS for web servers</h2>
<p>Users accessing an organisation’s digital public services need to have confidence that they are accessing a legitimate service and that their communications remain private and free from interference. TLS is a protocol that provides this security.</p>
<p>TLS used in the context of web servers is known as HTTPS (that is HTTP over TLS).</p>
<h3><strong>Selecting protocol versions, cryptographic algorithms and parameters</strong></h3>
<p>There are many configuration options that affect the security of a service and communications with it. Unfortunately, selecting the most secure configuration may mean some users are unable to connect to your service. For this reason, you may need to find a balance between security and those users that it's essential the service can reach.</p>
<p>In Mozilla’s&nbsp;<a href="https://www.ssllabs.com/projects/best-practices/index.html">advice on Server Side TLS</a>, several TLS configurations are described (‘Modern’, ‘Intermediate’, and ‘Old’) that refer to some of the 'best' security settings possible, depending on the versions of the browsers that need to be supported. Supporting the ‘Old’ profile is risky and should be avoided, as it would mean supporting the insecure SSL protocol.</p>
<p>You should configure the web server to prefer more recent versions of protocols and more secure options first. The server should also be configured&nbsp;<strong>not</strong>&nbsp;to revert to an older standard after the initial negotiation.&nbsp;<a href="https://wiki.mozilla.org/Security/Server_Side_TLS#Prioritization_logic">Mozilla’s guide</a>&nbsp;provides some good recommendations on how to configure the prioritisation logic of your web server.</p>
<p>For web services that will only be accessed by known (well-maintained) end user devices, then it should be possible to deploy a strict cryptographic profile. In these situations we recommend you use one of the&nbsp;<a href="https://www.ncsc.gov.uk/guidance/tls-external-facing-services#profiles">preferred TLS configurations given below</a>.</p>
<h3><strong>Secure configuration recommendations</strong></h3>
<p>There are a number of good guides that provide configuration advice for HTTPS:</p>
<p><a href="https://www.ssllabs.com/projects/best-practices/index.html">Qualys - SSL/TLS Deployment Best Practices</a></p>
<p><a href="https://support.google.com/webmasters/answer/6073543">Google - Webmasters: Secure Your Site with HTTPS</a></p>
<p><a href="https://wiki.mozilla.org/Security/Server_Side_TLS#Modern_compatibility">Mozilla Security/Server Side TLS</a></p>
<p>We also recommend the following when deploying your services:</p>
<p>publish services only using HTTPS</p>
<p>automatically redirect users who visit the HTTP version of your service to the HTTPS version</p>
<p>use the latest versions of TLS libraries and supporting web frameworks; implementation issues can introduce vulnerabilities in the libraries which can quickly be exploited if not patched promptly</p>
<p>follow the guidance on secure application design from Qualys (see&nbsp;<a href="https://github.com/ssllabs/research/wiki/SSL-and-TLS-Deployment-Best-Practices">section 4</a>&nbsp;of Qualys - SSL/TLS Deployment Best Practices)</p>
<p>enable&nbsp;<a href="https://www.owasp.org/index.php/HTTP_Strict_Transport_Security">HTTP Strict Transport Security (HSTS)</a>&nbsp;to help the browser secure connections to your service; one or both of the following steps should be taken:</p>
<ul>
  <li>add the Strict-Transport-Security HTTP header when the site is accessed over HTTPS - this instructs the browser to only request the HTTPS version in future (until the expiration time in the header elapses)</li>
  <li>add your sites to the HSTS preload lists which modern browsers use to automatically redirect HTTP traffic to HTTPS (&nbsp;<a href="https://hstspreload.org/">Chrome’s preload list</a>&nbsp;is included in many of the other browsers’ lists)</li>
</ul>
<p>design new applications to use&nbsp;<a href="https://developer.mozilla.org/en-US/docs/Web/Security/CSP/Introducing_Content_Security_Policy">Content Security Policy</a>, as it can be difficult to retrofit later</p>
<p>server certificates should be acquired from&nbsp;<a href="https://www.ncsc.gov.uk/guidance/tls-external-facing-services#choosing-a-certificate-authority">trustworthy and reputable sources</a></p>
<p>publish&nbsp;<a href="https://en.wikipedia.org/wiki/DNS_Certification_Authority_Authorization">DNS Certificate Authority Authorization</a>&nbsp;(CAA) records to manage which Certificate Authorities will issue certificates for your domain.</p>
<ul>
  <li>ensure you have a means of revoking compromised certificates for your services - you should be able to do this through your chosen Certificate Authority (CA)</li>
  <li>consider advising users if their web browsers are not supporting a sufficient set of TLS algorithms, and providing them with information on how to upgrade their web browser or operating system if appropriate</li>
</ul>
<hr>
<h2>Deploying TLS for mail servers</h2>
<p>TLS for mail servers guidance can be found&nbsp;<a href="https://www.ncsc.gov.uk/guidance/email-security-and-anti-spoofing">here</a>.</p>
<hr>
<h2>Choosing a Certificate Authority</h2>
<p>TLS uses X.509v3 certificates to cryptographically validate identities presented by one or both of the communicating parties. If the connecting party is able to validate that the certificate presented to it is issued by a CA it trusts, then secure communications should be established. It is therefore important to choose a CA that is widely trusted by those likely to connect to your services. If selecting a less common CA, it is possible that the certificates presented by your service may not be able to be validated by the connecting party, and the other party may choose not to continue the session.</p>
<p>In order to verify the certificate presented by your server, the web browser or mail server may use its own store of trusted root CAs, or it may refer to the CAs trusted by the operating system. As there is no universal list of trusted CAs, you will need to research support for your chosen CA in the likely web browsers or mail servers and services expected to connect to your service.</p>
<p>Further good advice on what to look for in a CA is set out in section 1.4 of the&nbsp;<a href="https://www.ssllabs.com/projects/best-practices/index.html">Qualys - SSL/TLS Deployment Best Practices guide</a>.</p>
<h3><strong>Requesting a certificate</strong></h3>
<p>In order to have an X.509v3 certificate signed by a CA, you would normally generate your own private key, and send a Certificate Signing Request (CSR) to the CA to be signed, thus keeping your private key secret. There are several parameters you can choose for your private key and signing request. The main choice is whether to support RSA certificates and keys, or Elliptic Curve Cryptography (ECC); either can offer acceptable security. Some mail and web servers support both ECC and RSA, and will select the appropriate certificate based upon the TLS negotiation with the connecting party.</p>
<p>If generating an RSA certificate, we recommend using the following parameters:</p>
<p>2048-bit RSA with SHA256</p>
<p>If generating an ECC certificate, we recommend using the following parameters:</p>
<p>ECDSA-256 with SHA256 on the P-256 curve</p>
<hr>
<h2>Testing</h2>
<p>Given the wide range of configuration options available for TLS, we recommend that you regularly test the configuration of your web servers and mail servers by running automated scans. There are a number of publicly available tools to help test the TLS configuration of your web or mail server. Some tools you may find useful are:</p>
<p><a href="https://www.ssllabs.com/ssltest/">Qualys SSL Server Test</a></p>
<p>Check TLS services from&nbsp;<a href="http://www.checktls.com/index.html">checktls.com</a></p>
<p>These scans will identify most common issues and configuration problems. They should not be seen as a replacement for skilled penetration testing of your services, but if you have already used tools such as these to help identify and mitigate common issues, then penetration testers will have more time to spend ensuring there are not more subtle or unique flaws in your service.</p>
<p>Note that whilst it is possible for others to test the ability for you to receive email securely, it is&nbsp;<strong>not</strong>&nbsp;possible for others to test the ability of your services to send email securely without your cooperation. You have to send an email to a testing service, such as that offered by&nbsp;<a href="http://checktls.com/">checktls.com</a>.</p>
<hr>
<h2>Recommended cryptographic profiles for TLS</h2>
<p>Where support for legacy browsers or applications is not an issue, we recommend you select one of the two cryptographic profiles for TLS:</p>
<h3><strong>Combination 1 of the Suite B profile for TLS</strong></h3>
<p>A summary of the Suite B profile for TLS is below:</p>
<figure class="table" style="width:635px;">
  <table style="background-color:rgb(255, 255, 255);border-bottom:0px;border-left:0px;border-right:0px;border-top:0px;">
    <thead>
      <tr>
        <th style="border-bottom:3px solid rgb(5, 28, 72);border-left:0px;border-right:0px;border-top:0px !important;padding:0px 0px 16px;width:113px;"><strong>Algorithm type</strong></th>
        <th style="border-bottom:3px solid rgb(5, 28, 72);border-left:0px;border-right:0px;border-top:0px !important;padding:0px 0px 16px 30px;width:261px;"><strong>Description</strong></th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td style="border-bottom:none;border-left:0px;border-right:0px;border-top:1px solid rgb(170, 170, 170);padding:0px 0px 16px;">Protocol</td>
        <td style="border-bottom:none;border-left:0px;border-right:0px;border-top:1px solid rgb(170, 170, 170);padding:16px 0px 16px 30px;">TLS v1.2</td>
      </tr>
      <tr>
        <td style="border-bottom:none;border-left:0px;border-right:0px;border-top:1px solid rgb(170, 170, 170);padding:0px 0px 16px;">Encryption</td>
        <td style="border-bottom:none;border-left:0px;border-right:0px;border-top:1px solid rgb(170, 170, 170);padding:16px 0px 16px 30px;">AES with 128-bit key in GCM mode</td>
      </tr>
      <tr>
        <td style="border-bottom:none;border-left:0px;border-right:0px;border-top:1px solid rgb(170, 170, 170);padding:0px 0px 16px;">Pseudo-random function</td>
        <td style="border-bottom:none;border-left:0px;border-right:0px;border-top:1px solid rgb(170, 170, 170);padding:16px 0px 16px 30px;">TLS PRF (with SHA-256)</td>
      </tr>
      <tr>
        <td style="border-bottom:none;border-left:0px;border-right:0px;border-top:1px solid rgb(170, 170, 170);padding:0px 0px 16px;">Authentication</td>
        <td style="border-bottom:none;border-left:0px;border-right:0px;border-top:1px solid rgb(170, 170, 170);padding:16px 0px 16px 30px;">ECDSA-256 with SHA-256 on P-256 curve</td>
      </tr>
      <tr>
        <td style="border-bottom:none;border-left:0px;border-right:0px;border-top:1px solid rgb(170, 170, 170);padding:0px;">Key exchange</td>
        <td style="border-bottom:none;border-left:0px;border-right:0px;border-top:1px solid rgb(170, 170, 170);padding:16px 0px 0px 30px;">ECDH using P-256 curve</td>
      </tr>
    </tbody>
  </table>
</figure>
<h3><strong>Foundation Profile for TLS</strong></h3>
<p>Depending on equipment and infrastructure support, deploying Combination 1 of the Suite B profile for TLS may not be achievable. A suitable alternative is the Foundation Profile for TLS. This profile consists of an RFC-compliant implementation of TLS using the algorithms given in the table below:</p>
<figure class="table" style="width:635px;">
  <table style="background-color:rgb(255, 255, 255);border-bottom:0px;border-left:0px;border-right:0px;border-top:0px;">
    <thead>
      <tr>
        <th style="border-bottom:3px solid rgb(5, 28, 72);border-left:0px;border-right:0px;border-top:0px !important;padding:0px 0px 16px;width:113px;"><strong>Algorithm type</strong></th>
        <th style="border-bottom:3px solid rgb(5, 28, 72);border-left:0px;border-right:0px;border-top:0px !important;padding:0px 0px 16px 30px;width:261px;"><strong>Description</strong></th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td style="border-bottom:none;border-left:0px;border-right:0px;border-top:1px solid rgb(170, 170, 170);padding:0px 0px 16px;">Protocol</td>
        <td style="border-bottom:none;border-left:0px;border-right:0px;border-top:1px solid rgb(170, 170, 170);padding:16px 0px 16px 30px;">TLS v1.2</td>
      </tr>
      <tr>
        <td style="border-bottom:none;border-left:0px;border-right:0px;border-top:1px solid rgb(170, 170, 170);padding:0px 0px 16px;">Encryption</td>
        <td style="border-bottom:none;border-left:0px;border-right:0px;border-top:1px solid rgb(170, 170, 170);padding:16px 0px 16px 30px;">AES with 128-bit key in CBC mode</td>
      </tr>
      <tr>
        <td style="border-bottom:none;border-left:0px;border-right:0px;border-top:1px solid rgb(170, 170, 170);padding:0px 0px 16px;">Pseudo-random function</td>
        <td style="border-bottom:none;border-left:0px;border-right:0px;border-top:1px solid rgb(170, 170, 170);padding:16px 0px 16px 30px;">TLS PRF (with SHA-256)</td>
      </tr>
      <tr>
        <td style="border-bottom:none;border-left:0px;border-right:0px;border-top:1px solid rgb(170, 170, 170);padding:0px 0px 16px;">Authentication</td>
        <td style="border-bottom:none;border-left:0px;border-right:0px;border-top:1px solid rgb(170, 170, 170);padding:16px 0px 16px 30px;">X.509 certificates with RSA signatures (2048 bits) and SHA-256</td>
      </tr>
      <tr>
        <td style="border-bottom:none;border-left:0px;border-right:0px;border-top:1px solid rgb(170, 170, 170);padding:0px 0px 16px;">Key exchange</td>
        <td style="border-bottom:none;border-left:0px;border-right:0px;border-top:1px solid rgb(170, 170, 170);padding:16px 0px 16px 30px;">DH Group 14 (2048-bit MODP Group)</td>
      </tr>
      <tr>
        <td style="border-bottom:none;border-left:0px;border-right:0px;border-top:1px solid rgb(170, 170, 170);padding:0px;">Integrity</td>
        <td style="border-bottom:none;border-left:0px;border-right:0px;border-top:1px solid rgb(170, 170, 170);padding:16px 0px 0px 30px;">SHA-256</td>
      </tr>
    </tbody>
  </table>
</figure>
<p>Deviation from this profile, such as through the use of GCM rather than CBC mode, or the use of Perfect Forward Secrecy (PFS), may be required or desirable, and is acceptable.</p>
