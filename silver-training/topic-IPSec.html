<!--
title: Using IPsec to protect data
description: Guidance for organisations wishing to deploy or buy network encryption, using IPsec.
published: true
date: 2021-02-22T00:33:04.262Z
tags: silver, ncsc, silver training, topics
editor: ckeditor
dateCreated: 2021-02-22T00:33:04.262Z
-->

<h2>Introduction</h2>
<p>This&nbsp;guide will&nbsp;help you&nbsp;deploy or buy&nbsp;network encryption, using IPsec. It provides recommendations for the selection and configuration of relevant equipment. It also&nbsp;describes&nbsp;how a network encryption service needs to operate to provide an understood level of security.&nbsp;The recommendations in this guidance&nbsp;balance security and usability.&nbsp;</p>
<hr>
<h2>About this guidance</h2>
<p>This guide is for the protection of information flows within a single organisation, or within a group of organisations, across bearer networks such as the Internet, a commercial WAN circuit, or the Public&nbsp;Services Network (PSN) for public sector organisations.&nbsp;Other scenarios may benefit from the use of some aspects of this guidance, such as the protection of information flows on dedicated links between organisations and cloud service providers, or in the inter-data-centre connections in such providers' networks.</p>
<p><i>Note</i></p>
<p>The underlying bearer network is assumed not to provide any security or resilience. This means that any bearer network (such as the Internet, Wi-Fi or a commercial MPLS network) can be used. The choice of bearer network(s) will have an impact on the availability that an encrypted service can provide.</p>
<hr>
<h2>About IPsec</h2>
<p>IPsec helps protect the confidentiality and integrity of your information as it travels across less-trusted networks.&nbsp;Network-based encryption is implemented using the IPsec protocol to establish Virtual Private Networks (VPNs). This can be performed by a software client running on an End User Device (EUD), by a dedicated hardware appliance (a VPN gateway), or as additional functionality in other networking infrastructure equipment (such as a router).</p>
<p>IPsec VPNs may be dedicated to a single purpose (such as two gateways which connect data centres together.) Alternatively, a single gateway may be used by multiple clients as required (for example, for remote working connections).</p>
<hr>
<h2>Basic principles</h2>
<p>Establishing trustworthy encrypted network links is not just about technology. It is also important that the management of these networks links is carried out by appropriate individuals, performing their assigned management activities in a competent and trusted fashion, from a management system that protects the overall integrity of the system.&nbsp;</p>
<p>Devices which implement cryptographic protection of&nbsp;information using IPsec should:</p>
<p><a href="https://www.ncsc.gov.uk/guidance/acquiring-managing-and-disposing-network-devices">be managed</a><a href="https://cesgdet.atlassian.net/wiki/display/CES/OBSOLETE+-+Managing+Network+Devices">&nbsp;</a>by a competent authority in a manner that does not undermine the protection they provide, from a suitable management platform.</p>
<p>be configured to provide effective&nbsp;<a href="https://www.ncsc.gov.uk/guidance/using-ipsec-protect-data#crypt">cryptographic protection</a></p>
<ul>
  <li>use&nbsp;<a href="https://www.ncsc.gov.uk/guidance/provisioning-and-securing-security-certificates">certificates</a>&nbsp;as a means of identifying and trusting other devices, using a suitable PKI</li>
</ul>
<p>be independently assured to Foundation Grade, and operated in accordance with published Security Procedures</p>
<p>be&nbsp;<a href="https://www.ncsc.gov.uk/guidance/acquiring-managing-and-disposing-network-devices">initially deployed</a>&nbsp;in a manner that ensures their future trustworthiness</p>
<p>be&nbsp;<a href="https://www.ncsc.gov.uk/guidance/secure-sanitisation-storage-media">disposed of securely</a></p>
<h3><strong>Keep the network design simple</strong></h3>
<p>Keeping the network design simple is one of the most effective ways to ensure the network provides the expected security and performance. With this in mind:</p>
<p>Avoid the need for too much security functionality in any single product or network feature, as a failure in one will likely compromise all.</p>
<p>VPN gateways should ideally have three interfaces; a LAN-side interface which has plain-text traffic on it, a WAN-side interface with IPsec-encrypted data, and a management interface (which may be local, or WAN-connected with suitable encryption).</p>
<p><a href="https://www.ncsc.gov.uk/guidance/end-user-devices-security-guidance-introduction-0">End User Devices</a>&nbsp;should have a single WAN interface.</p>
<p>Some network designs may use multiple LAN or WAN interfaces, as well as traffic routing rules at layers 2 - 4 which cause data either to be passed in-clear or to be encrypted (based on traffic characteristics such as destination IP address / port / VLAN ID etc). However, adding additional complexity to the network design increases the risk that traffic will be mis-routed, or that devices will become mis-configured, allowing an attacker access to them (and the data they protect). If such routing represents a security barrier in the network design, then the devices performing this function should have had it included in their evaluation.</p>
<hr>
<h2>Recommended cryptographic profiles</h2>
<p>As a default policy, VPN gateways and clients should be configured to offer and accept only Foundation and PRIME profiles, and should not allow negotiation of alternative cipher suites unless explicitly permitted by an administrator.</p>
<ul>
  <li>For public sector organisations, use of the previous 'PSN Interim' profile remains acceptable until 31st December 2018 for the purposes of maintaining existing services, and enabling the transition to the above profiles</li>
  <li>We recommended that all IPsec VPNs migrate to use of the PRIME or Foundation cryptographic profile by 1st January 2018.</li>
  <li>The Foundation Profile is expected to provide suitable protection for OFFICIAL information until at least 31st December 2023. This date will be reviewed on an annual basis, with a yearly extension on continued acceptability as appropriate.</li>
  <li>Depending on equipment and infrastructure support, deployment of either the Foundation or PRIME profile is acceptable.</li>
</ul>
<p>The recommended algorithms and key sizes for root and sub-CAs used to issue certificates for end entity devices are:</p>
<figure class="table" style="width:635px;">
  <table style="background-color:rgb(255, 255, 255);border-bottom:0px;border-left:0px;border-right:0px;border-top:0px;">
    <tbody>
      <tr>
        <td style="border-bottom:none;border-left:0px;border-right:0px;border-top:1px solid rgb(170, 170, 170);padding:0px 0px 16px;"><strong>Profile</strong></td>
        <td style="border-bottom:none;border-left:0px;border-right:0px;border-top:1px solid rgb(170, 170, 170);padding:16px 0px 16px 30px;"><strong>Details</strong></td>
      </tr>
      <tr>
        <td style="border-bottom:none;border-left:0px;border-right:0px;border-top:1px solid rgb(170, 170, 170);padding:0px 0px 16px;">Foundation</td>
        <td style="border-bottom:none;border-left:0px;border-right:0px;border-top:1px solid rgb(170, 170, 170);padding:16px 0px 16px 30px;">2048-bit RSA and SHA-256</td>
      </tr>
      <tr>
        <td style="border-bottom:none;border-left:0px;border-right:0px;border-top:1px solid rgb(170, 170, 170);padding:0px;">PRIME</td>
        <td style="border-bottom:none;border-left:0px;border-right:0px;border-top:1px solid rgb(170, 170, 170);padding:16px 0px 0px 30px;">ECDSA-256 and SHA-256</td>
      </tr>
    </tbody>
  </table>
</figure>
<h3><strong>PRIME profile for IPsec</strong></h3>
<p>The recommended IPsec cipher suite profile for protecting information is called PRIME. A non-authoritative summary is provided in the table below:</p>
<figure class="table" style="width:635px;">
  <table style="background-color:rgb(255, 255, 255);border-bottom:0px;border-left:0px;border-right:0px;border-top:0px;">
    <tbody>
      <tr>
        <td style="border-bottom:none;border-left:0px;border-right:0px;border-top:1px solid rgb(170, 170, 170);padding:0px 0px 16px;"><strong>IKEv2</strong></td>
        <td style="border-bottom:none;border-left:0px;border-right:0px;border-top:1px solid rgb(170, 170, 170);padding:16px 0px 16px 30px;"><strong>Selection</strong></td>
      </tr>
      <tr>
        <td style="border-bottom:none;border-left:0px;border-right:0px;border-top:1px solid rgb(170, 170, 170);padding:0px 0px 16px;">Encryption</td>
        <td style="border-bottom:none;border-left:0px;border-right:0px;border-top:1px solid rgb(170, 170, 170);padding:16px 0px 16px 30px;">AES-128 in GCM-128 (and optionally CBC)</td>
      </tr>
      <tr>
        <td style="border-bottom:none;border-left:0px;border-right:0px;border-top:1px solid rgb(170, 170, 170);padding:0px 0px 16px;">Pseudo-random function</td>
        <td style="border-bottom:none;border-left:0px;border-right:0px;border-top:1px solid rgb(170, 170, 170);padding:16px 0px 16px 30px;">HMAC-SHA256</td>
      </tr>
      <tr>
        <td style="border-bottom:none;border-left:0px;border-right:0px;border-top:1px solid rgb(170, 170, 170);padding:0px 0px 16px;">Diffie-Hellman Group</td>
        <td style="border-bottom:none;border-left:0px;border-right:0px;border-top:1px solid rgb(170, 170, 170);padding:16px 0px 16px 30px;">256bit random ECP (RFC5903) Group 19</td>
      </tr>
      <tr>
        <td style="border-bottom:none;border-left:0px;border-right:0px;border-top:1px solid rgb(170, 170, 170);padding:0px;">Authentication</td>
        <td style="border-bottom:none;border-left:0px;border-right:0px;border-top:1px solid rgb(170, 170, 170);padding:16px 0px 0px 30px;">ECDSA-256 with SHA256 on P-256 curve</td>
      </tr>
    </tbody>
  </table>
</figure>
<figure class="table" style="width:635px;">
  <table style="background-color:rgb(255, 255, 255);border-bottom:0px;border-left:0px;border-right:0px;border-top:0px;">
    <tbody>
      <tr>
        <td style="border-bottom:none;border-left:0px;border-right:0px;border-top:1px solid rgb(170, 170, 170);padding:0px 0px 16px;"><strong>ESP</strong></td>
        <td style="border-bottom:none;border-left:0px;border-right:0px;border-top:1px solid rgb(170, 170, 170);padding:16px 0px 16px 30px;"><strong>Selection</strong></td>
      </tr>
      <tr>
        <td style="border-bottom:none;border-left:0px;border-right:0px;border-top:1px solid rgb(170, 170, 170);padding:0px;">Encryption</td>
        <td style="border-bottom:none;border-left:0px;border-right:0px;border-top:1px solid rgb(170, 170, 170);padding:16px 0px 0px 30px;">AES-128 in GCM-128</td>
      </tr>
    </tbody>
  </table>
</figure>
<p>Authoritative reference: CESG Technical Specifications No. 403 - PRIME Framework - Suite B.128 Module. Issue 1.2.2 November 2012.</p>
<h3><strong>Foundation profile for IPsec</strong></h3>
<p>This profile consists of an RFC-compliant implementation of IPsec with IKEv1 (RFC2408 and RFC2409 apply), without custom extensions, using Extended Sequence Numbers (RFC4304), Encapsulating Security Payload (ESP - RFC4303), and the algorithms given in the tables below:</p>
<figure class="table" style="width:635px;">
  <table style="background-color:rgb(255, 255, 255);border-bottom:0px;border-left:0px;border-right:0px;border-top:0px;">
    <tbody>
      <tr>
        <td style="border-bottom:none;border-left:0px;border-right:0px;border-top:1px solid rgb(170, 170, 170);padding:0px 0px 16px;"><strong>IKEv1</strong></td>
        <td style="border-bottom:none;border-left:0px;border-right:0px;border-top:1px solid rgb(170, 170, 170);padding:16px 0px 16px 30px;"><strong>Selection</strong></td>
      </tr>
      <tr>
        <td style="border-bottom:none;border-left:0px;border-right:0px;border-top:1px solid rgb(170, 170, 170);padding:0px 0px 16px;">Encryption</td>
        <td style="border-bottom:none;border-left:0px;border-right:0px;border-top:1px solid rgb(170, 170, 170);padding:16px 0px 16px 30px;">AES with 128-bit keys in CBC mode (RFC3602)</td>
      </tr>
      <tr>
        <td style="border-bottom:none;border-left:0px;border-right:0px;border-top:1px solid rgb(170, 170, 170);padding:0px 0px 16px;">Pseudo-Random Function</td>
        <td style="border-bottom:none;border-left:0px;border-right:0px;border-top:1px solid rgb(170, 170, 170);padding:16px 0px 16px 30px;">HMAC-SHA-256 (RFC4868)</td>
      </tr>
      <tr>
        <td style="border-bottom:none;border-left:0px;border-right:0px;border-top:1px solid rgb(170, 170, 170);padding:0px 0px 16px;">Diffie-Hellman Group</td>
        <td style="border-bottom:none;border-left:0px;border-right:0px;border-top:1px solid rgb(170, 170, 170);padding:16px 0px 16px 30px;">Group 14 (2048-bit MODP Group) (RFC3526)</td>
      </tr>
      <tr>
        <td style="border-bottom:none;border-left:0px;border-right:0px;border-top:1px solid rgb(170, 170, 170);padding:0px;">Authentication</td>
        <td style="border-bottom:none;border-left:0px;border-right:0px;border-top:1px solid rgb(170, 170, 170);padding:16px 0px 0px 30px;">X.509 certificates with RSA signatures (2048 bits) and SHA-256 (RFC4945 and RFC4055)</td>
      </tr>
    </tbody>
  </table>
</figure>
<figure class="table" style="width:635px;">
  <table style="background-color:rgb(255, 255, 255);border-bottom:0px;border-left:0px;border-right:0px;border-top:0px;">
    <tbody>
      <tr>
        <td style="border-bottom:none;border-left:0px;border-right:0px;border-top:1px solid rgb(170, 170, 170);padding:0px 0px 16px;"><strong>ESP</strong></td>
        <td style="border-bottom:none;border-left:0px;border-right:0px;border-top:1px solid rgb(170, 170, 170);padding:16px 0px 16px 30px;"><strong>Selection</strong></td>
      </tr>
      <tr>
        <td style="border-bottom:none;border-left:0px;border-right:0px;border-top:1px solid rgb(170, 170, 170);padding:0px 0px 16px;">Encryption</td>
        <td style="border-bottom:none;border-left:0px;border-right:0px;border-top:1px solid rgb(170, 170, 170);padding:16px 0px 16px 30px;">AES with 128-bit keys in CBC mode (RFC3602)</td>
      </tr>
      <tr>
        <td style="border-bottom:none;border-left:0px;border-right:0px;border-top:1px solid rgb(170, 170, 170);padding:0px;">Integrity</td>
        <td style="border-bottom:none;border-left:0px;border-right:0px;border-top:1px solid rgb(170, 170, 170);padding:16px 0px 0px 30px;">SHA-256 (RFC4868)</td>
      </tr>
    </tbody>
  </table>
</figure>
<p>IKE phase 1 MUST use Main mode. SA lifetimes must be 86400 seconds (1 day) for Phase 1 and 28800 seconds (8 hours) for Phase 2.</p>
<p>Certain network functionality may require deviation from this profile. It is acceptable to replace any element of the Foundation profile with the corresponding element from the PRIME profile (for example, using IKEv2 instead of IKEv1). Until the transition date below, if interoperability is required, the Foundation profile should be used.</p>
<p>We are aware that some currently fielded devices are unable to perform SHA-256-128 for the ESP integrity algorithm. In accordance with wider recommendations on the use of SHA-1, it is acceptable to continue to use HMAC-SHA-1 as the ESP integrity algorithm at this time.</p>
<h3><strong>Certificates</strong></h3>
<p>For most IPsec-based networks, VPN gateways and clients will need to use certificates based on a central trust infrastructure to successfully identify themselves to other VPN devices. We have guidance on the&nbsp;<a href="https://www.ncsc.gov.uk/guidance/provisioning-and-securing-security-certificates">use and management of certificates</a>.</p>
<p>We do not recommend using Pre-Shared Keys (PSKs), Group Domain of Interpretation (GDOI), and other approaches for establishing shared keys across multiple devices. However, we recognise that Pre-Shared Keys are widely used in site-to-site VPNs. In this case we recommend that keys are generated in a cryptographically secure manner to ensure that the they have a high level of entropy to help mitigate brute force attacks.</p>
